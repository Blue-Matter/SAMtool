<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to SAMtool and model-based MPs • SAMtool</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to SAMtool and model-based MPs">
<meta property="og:description" content="SAMtool">
<meta property="og:image" content="https://SAMtool.openMSE.com/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SAMtool</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/SAMtool.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Blue-Matter/SAMtool/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="SAMtool_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to SAMtool and model-based MPs</h1>
            <h3 class="subtitle">Development, testing, and implementation of model-based management procedures</h3>
                        <h4 class="author">Quang Huynh (<a href="mailto:quang@bluematterscience.com" class="email">quang@bluematterscience.com</a>), Tom Carruthers (<a href="mailto:tom@bluematterscience.com" class="email">tom@bluematterscience.com</a>), Adrian Hordyk (<a href="mailto:adrian@bluematterscience.com" class="email">adrian@bluematterscience.com</a>)</h4>
            
            <h4 class="date">2021-09-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Blue-Matter/SAMtool/blob/master/vignettes/SAMtool.Rmd"><code>vignettes/SAMtool.Rmd</code></a></small>
      <div class="hidden name"><code>SAMtool.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>As part of openMSE, SAMtool implements closed-loop simulation testing of management procedures (MP), a process used in management strategy evaluation (MSE). The components of the operating model (OM) for conducting MSEs for data-rich stocks is wholly contained within MSEtool, but SAMtool provides the tools for implementing additional features to facilitate model-based MPs. Whereas DLMtool is primarily designed for testing data-limited MPs, SAMtool provides an object-oriented framework for building out data-rich MPs, which typically combine an assessment model with a harvest control rule (HCR) to provide a catch recommendation. MPs created by SAMtool are designed to be used with the operating model of MSEtool through the <code>runMSE</code> function.</p>
<p>The overall structure of a closed-loop simulation for a MSE in MSEtool can be described through the classes deployed in the package. An operating model (class <strong>OM</strong> object) parameterizes the stock (biology), fleet, observation, and implementation dynamics of the MSE. To begin the MSE, the <strong>OM</strong> object generates the data to be used for a management procedure and stores them in an object of class <strong>Data</strong>. A function of class <strong>MP</strong> uses the <strong>Data</strong> object and returns an object of class <strong>Rec</strong> containing the management recommendations, e.g., some combination of spatial closures and size, effort and catch limits. Candidate MPs should not see the operating model and interacts solely with data simulated in the <strong>Data</strong> object. From the management recommendations, the <strong>OM</strong> object is updated and the process is successively repeated as the operating model projects forward in time. The output from the closed-loop simulation is returned in an object of class <strong>MSE</strong>, from which summary statistics can be calculated.</p>
<p><img src="fig_assess/MSEtool_design.png" width="400"></p>
<p><em>Figure 1: Design of MSEtool package for management strategy evaluations</em></p>
<div id="overview-of-samtool" class="section level2">
<h2 class="hasAnchor">
<a href="#overview-of-samtool" class="anchor"></a>Overview of SAMtool</h2>
<p>To facilitate a standardized design for data-rich MPs, SAMtool creates new classes to build out the <strong>MP</strong> class. SAMtool uses functions of class <strong>Assess</strong> and <strong>HCR</strong> for an assessment model and harvest control rule, respectively. An <strong>MP</strong> class function can be made from these functions to be tested within the MSEtool framework.</p>
<p>Additionally, <strong>Assess</strong> functions can be used in an assessment-only context (external to closed-loop simulation). Output of an <strong>Assess</strong> function can be used to provide standardized stock assessment reporting and diagnostics, such as Kobe plots, likelihood profiles for parameter estimates, and retrospective analyses of time series estimates of biomass, fishing mortality, recruitment, etc.</p>
<p><img src="fig_assess/SAMtool_design.png" width="690"></p>
<p><em>Figure 2: Design of SAMtool package for building management procedures from assessment models and harvest control rules for closed-loop simulation with the MSEtool package. Assess and HCR functions and the Assessment object are unique to SAMtool, but work within the framework of MSEtool. Separate functions are also available for standardized reporting of output from assessment models in a stock assessment setting.</em></p>
</div>
<div id="additional-features" class="section level2">
<h2 class="hasAnchor">
<a href="#additional-features" class="anchor"></a>Additional features</h2>
<p>SAMtool provides a conditioning model (RCM, for Rapid Conditioning Model) for generating operating models fitted to data.</p>
<p>Articles with the description of the <a href="https://openmse.com/features-assessment-models/">assessment models</a> and the <a href="https://openmse.com/tutorial-rcm/">RCM</a> are available on the <a href="https://openmse.com/">openMSE</a> website.</p>
<p>To support multiple-area operating models, the <code>simmov</code> function estimates the movement matrix based on the prescribed number of areas, biomass distribution among areas in unfished conditions, and the probability of staying in each area in the next time step.</p>
</div>
</div>
<div id="assessment-models" class="section level1">
<h1 class="hasAnchor">
<a href="#assessment-models" class="anchor"></a>Assessment models</h1>
<p>Assessment models in SAMtool are functions of class <strong>Assess</strong>. Currently, the following assessment functions are available:</p>
<ul>
<li>
<code>DD_TMB</code> (Delay-Difference model and its state-space counterpart, <code>DD_SS</code>)</li>
<li>
<code>cDD</code> (Continuous Delay-Differential model and its state-space counterpart, <code>cDD_SS</code>)</li>
<li>
<code>SP</code> (Surplus Production model and its state-space counterpart, <code>SP_SS</code>)</li>
<li>
<code>SCA</code> (Statistical Catch at age model and variants for time varying M: <code>SCA_RWM</code> and <code>SCA_DDM</code>)</li>
<li>
<code>SSS</code> (Simple Stock Synthesis implementation with fixed terminal depleton assumption)</li>
<li>
<code>VPA</code> (Virtual Population Analysis)</li>
</ul>
<p>These functions take a <strong>Data</strong> object as an argument and return an object of class <strong>Assessment</strong>, for example,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SCA_assessment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SCA.html">SCA</a></span><span class="op">(</span>Data <span class="op">=</span> <span class="fu">MSEtool</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/MSEtool/man/SimulatedData.html">SimulatedData</a></span>, fix_h <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
<p>where <code>...</code> are model configuration arguments. For example, in this SCA model we will try to estimate steepness instead of fixing it to value specified in the <strong>Data</strong> object.</p>
<p>The <strong>Assessment</strong> object contains the raw output from TMB estimation model, optimization results from <code>nlminb</code>, and parameter estimates with covariance matrix. If applicable, time series estimates of total biomass, vulnerable biomass, spawning stock biomass, fishing mortality and/or exploitation rate, as well as their corresponding MSY and unfished reference points. The <strong>Assessment</strong> object also reports likelihood values and predicted values for the data used in the assessment model. The object documentation for the <strong>Assessment</strong> object can be obtained through:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">class</span><span class="op">?</span><span class="va">Assessment</span></code></pre></div>
<p>Descriptions of the <strong>Assess</strong> functions are provided in separate vignettes, available:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/browseVignettes.html">browseVignettes</a></span><span class="op">(</span><span class="st">"SAMtool"</span><span class="op">)</span></code></pre></div>
<div id="reporting-and-diagnostic-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#reporting-and-diagnostic-functions" class="anchor"></a>Reporting and diagnostic functions</h2>
<p>Assessment results and summary, along with diagnostic procedures are available for each assessment model. Generic functions <code>summary</code> and <code>plot</code> are available for <strong>Assessment</strong> objects. The <code>summary</code> function returns a list of estimated current stock status (<span class="math inline">\(F/F_{MSY}\)</span> , <span class="math inline">\(B/B_{MSY}\)</span> in the terminal year), input parameters to the model, derived quantities, and parameter estimates. The <code>plot</code> function generates a Markdown report with time series figures of data, fitted data, and estimated quantities (e.g., biomass and recruitment).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">SCA_assessment</span><span class="op">)</span> <span class="co"># By default, also saves figures in a temporary directory for viewing. The directory can be changed to a user's filespace of choice</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">SCA_assessment</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; $model
#&gt; [1] "Statistical Catch-at-Age (SCA)"
#&gt; 
#&gt; $current_status
#&gt;                Value
#&gt; F/FMSY     0.5115929
#&gt; SSB/SSBMSY 1.2148562
#&gt; SSB/SSB0   0.3027897
#&gt; 
#&gt; $input_parameters
#&gt;              Value              Description
#&gt; M        0.4147479        Natural mortality
#&gt; maxage  15.0000000 Maximum age (plus-group)
#&gt; Linf   138.5112774        Asymptotic length
#&gt; K        0.1616530       Growth coefficient
#&gt; t0      -1.4063466       Age at length-zero
#&gt; Winf    60.2341128        Asymptotic weight
#&gt; A50      5.4765479      Age of 50% maturity
#&gt; A95      7.4845256      Age of 95% maturity</code></pre>
<p>Two diagnostic functions are available: <code>retrospective</code> for retrospective analyses (re-running the model by sequentially removing terminal years of data) and <code>profile</code> for profiling the likelihood function over a grid of parameters.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/retrospective.html">retrospective</a></span><span class="op">(</span><span class="va">SCA_assessment</span>, nyr <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># Retrospective analysis going back 5 years from current year</span>
<span class="fu"><a href="../reference/profile.html">profile</a></span><span class="op">(</span><span class="va">SCA_result</span>, R0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">1.25</span>, <span class="fl">0.025</span><span class="op">)</span>, h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">1</span>, <span class="fl">2.5e-3</span><span class="op">)</span><span class="op">)</span> <span class="co"># Joint profile over grid of R0 and steepness</span></code></pre></div>
<pre><code>#&gt;                    Mohn's rho
#&gt; Fishing mortality      -0.095
#&gt; F/F[MSY]               -0.085
#&gt; Spawning biomass        0.116
#&gt; SSB/SSB[MSY]            0.088
#&gt; Spawning depletion      0.096
#&gt; Recruitment             0.096
#&gt; Vulnerable biomass      0.082</code></pre>
<p><img src="fig_assess/retrospective.png" width="600"></p>
<p><em>Figure 3: Retrospective trends in the SCA assessment fit and table of associated Mohn’s rho above.</em></p>
<p><img src="fig_assess/profile.png" width="600"></p>
<p><em>Figure 4: Joint profile of R0 and steepness from the SCA assessment model. Contours indicate change in likelihood values from minimum (red point).</em></p>
</div>
</div>
<div id="harvest-control-rules-hcrs" class="section level1">
<h1 class="hasAnchor">
<a href="#harvest-control-rules-hcrs" class="anchor"></a>Harvest control rules (HCRs)</h1>
<p>Harvest control rules in SAMtool are functions of class <strong>HCR</strong>, and are designed to provide different for a given assessment model. <strong>HCR</strong> functions take an object of class <strong>Assessment</strong> and return an object of class <strong>Rec</strong>. Currently, three <strong>HCR</strong> functions are available as output controls (catch limits): HCR_MSY, HCR40_10, and HCR60_20. HCR_MSY prescribes the TAC to be the catch predicted with fishing at the estimated <span class="math inline">\(F_{MSY}\)</span>, i.e., the product of <span class="math inline">\(F_{MSY}\)</span> and estimated vulnerable biomass, while HCR40_10 and HCR60_20 are ramped control rules which reduce the <span class="math inline">\(F_{MSY}\)</span> catch limit based on spawning depletion <span class="math inline">\(SSB/SSB_0\)</span>.</p>
<p><img src="SAMtool_files/figure-html/unnamed-chunk-9-1.png" width="480" style="display: block; margin: auto;"></p>
<p><em>Figure 5: The 40-10 harvest control rule prescribes an additional reduction in the TAC based on estimated spawning depletion.</em></p>
</div>
<div id="model-based-mps-in-closed-loop-simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#model-based-mps-in-closed-loop-simulation" class="anchor"></a>Model-based MPs in closed-loop simulation</h1>
<div id="creating-mps" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-mps" class="anchor"></a>Creating MPs</h2>
<p>SAMtool comes with a set of pre-built model-based MPs:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">avail</span><span class="op">(</span><span class="st">"MP"</span>, package <span class="op">=</span> <span class="st">"SAMtool"</span><span class="op">)</span>
<span class="co">#&gt; Searching for objects of class MP in package: SAMtool</span>
<span class="co">#&gt;  [1] "DDSS_4010"  "DDSS_75MSY" "DDSS_MSY"   "SCA_4010"   "SCA_75MSY" </span>
<span class="co">#&gt;  [6] "SCA_MSY"    "SP_4010"    "SP_75MSY"   "SP_MSY"     "SSS_4010"  </span>
<span class="co">#&gt; [11] "SSS_75MSY"  "SSS_MSY"</span></code></pre></div>
<p>These MPs use an assessment model and a harvest control rule to come up with a management recommendation (TAC).</p>
<p>The <code>make_MP</code> function is a convenient way to stitch together additional MPs from an assessment model and HCR. This is handy if an assessment model with a different configuration than the default is needed (for example, specify dome vulnerability instead of logistic vulnerability in <code>SCA</code>) or a different harvest control rule is desired. The resulting function can then be passed to <code><a href="https://rdrr.io/pkg/MSEtool/man/runMSE.html">MSEtool::runMSE()</a></code> as a management procedure.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SCA_MSY_</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_interim_MP.html">make_MP</a></span><span class="op">(</span><span class="va">SCA</span>, <span class="va">HCR_MSY</span>, diagnostic <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span>
<span class="va">SCA_4010_</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_interim_MP.html">make_MP</a></span><span class="op">(</span><span class="va">SCA</span>, <span class="va">HCR40_10</span>, diagnostic <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span>
<span class="va">myMSE</span> <span class="op">&lt;-</span> <span class="fu">MSEtool</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MSEtool/man/runMSE.html">runMSE</a></span><span class="op">(</span>OM <span class="op">=</span> <span class="fu">MSEtool</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/MSEtool/man/OM-class-objects.html">testOM</a></span>, MPs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FMSYref"</span>, <span class="st">"AvC"</span>, <span class="st">"SCA_MSY_"</span>, <span class="st">"SCA_4010_"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">MSEtool</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MSEtool/man/TradePlot.html">Tplot</a></span><span class="op">(</span><span class="va">myMSE</span><span class="op">)</span></code></pre></div>
<p><img src="fig_assess/Tplot.png" width="400"></p>
<p><em>Figure 6. Tradeoff plot between long-term catch and biomass of the SCA with two different HCRs, an average catch MP, and the FMSY reference (perfect FMSY implementation) MP.</em></p>
<p>Model configuration arguments can be passed through <code>...</code> in <code>make_MP</code> when the MP is made. For example, the Ricker stock-recruitment relationship can be used in the SCA instead of the default Beverton-Holt relationship and steepness can be fixed instead of estimated by passing argument <code>SR = "Ricker"</code> and <code>fix_h = TRUE</code>, respectively:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SCA_MSY_Ricker_fixsteep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_interim_MP.html">make_MP</a></span><span class="op">(</span><span class="va">SCA</span>, <span class="va">HCR_MSY</span>, SR <span class="op">=</span> <span class="st">"Ricker"</span>, fix_h <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>This MP will call <code><a href="../reference/SCA.html">SCA(..., SR = "Ricker", fix_h = TRUE)</a></code> in closed-loop.</p>
</div>
<div id="diagnostic-of-assessment-models-in-mse" class="section level2">
<h2 class="hasAnchor">
<a href="#diagnostic-of-assessment-models-in-mse" class="anchor"></a>Diagnostic of assessment models in MSE</h2>
<p>Three functions are designed to evaluate the performance of <strong>Assess</strong> models in MSE: <code>prelim_AM</code>, <code>diagnostic</code>, and <code>retrospective_AM</code> (where <em>AM</em> stands for “assessment in MSE”).</p>
<p><code>prelim_AM</code> is designed to evaluate the configuration of the assessment model before running the closed-loop simulation. Given an operating model, this function generates data from the historical period of the MSE, applies the assessment model to those data, then returns the convergence rate of the model. Low convergence rate could be be indicative of an OM for which the assessment model behaves pathologically. A list of <strong>Assessment</strong> objects are returned and can be used for troubleshooting. Additional arguments are passed to the <strong>Assess</strong> function via <code>...</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/prelim_AM.html">prelim_AM</a></span><span class="op">(</span><span class="fu">MSEtool</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/MSEtool/man/OM-class-objects.html">testOM</a></span>, <span class="va">DD_TMB</span>, <span class="va">...</span><span class="op">)</span>
<span class="co">#&gt; Running DD_TMB with 3 simulations for testOM.</span>
<span class="co">#&gt; Assessments complete.</span>
<span class="co">#&gt; Total time to run 3 assessments: 0.1 seconds</span>
<span class="co">#&gt; 0 of 3 simulations (0%) failed to converge.</span></code></pre></div>
<p>By default, assessment model results are not saved during the MSE. However, this feature can be turned on in <code>make_MP</code>, as shown in the following example:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SCA_MSY_</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_interim_MP.html">make_MP</a></span><span class="op">(</span><span class="va">SCA</span>, <span class="va">HCR_MSY</span>, diagnostic <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span></code></pre></div>
<p>By setting <code>diagnostic = "min"</code> (the default option), simple diagnostic information (e.g., convergence) from each model fit in closed-loop simulation is returned in the MSE object. With <code>diagnostic = "full"</code>, biomass and F estimates are also returned from each model fit in addition to the diagnostics.</p>
<p>The <code>diagnostic</code> function plots the convergence information, and <code>retrospective_AM</code> plots the assessment model’s retrospective patterns (for a single simulation within the closed-loop simulation).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/diagnostic.html">diagnostic</a></span><span class="op">(</span><span class="va">myMSE</span><span class="op">)</span>
<span class="fu"><a href="../reference/retrospective_AM.html">retrospective_AM</a></span><span class="op">(</span><span class="va">myMSE</span>, MP <span class="op">=</span> <span class="st">"SCA_MSY_"</span>, sim <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="fig_assess/diagnostic_AM.png" width="700"></p>
<p><em>Figure 7. Convergence diagnostics (return by TMB objects and nlminb function) for the DD_MSY MP during the MSE. Here, the assessment model was applied beginning in year 50 of the MSE and repeated every 4th year. In SAMtool, convergence is defined by a positive-definite Hessian matrix (top left figure). In the case of non-convergence, the previous management recommendation is used.</em></p>
<p><img src="fig_assess/retrospective_AM.png" width="700"></p>
<p><em>Figure 8. Retrospective analysis of the SCA in the SCA_MSY MP during the MSE for simulation #3. Operating model (true) values of spawning biomass (SSB), relative spawning biomass (SSB_SSBMSY), spawning biomass depletion (SSB_SSB0), fishing mortality (F), relative F (F_FMSY), and vulnerable biomass (VB) are in dark black. Colored lines indicate model estimates sequentially over the projection years. In simulation #3, the SCA tends to underestimate SSB (top left sub-plot).</em></p>
<p>Once it is determined that the SAMtool assessment models are performing adequately (no major convergence issues), then the performance of the MPs that use these models can be evaluated using performance metrics relevant to management.</p>
</div>
</div>
<div id="acknowledgements" class="section level1">
<h1 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h1>
<p>SAMtool development is funded by the Canadian Department of Fisheries and Oceans and benefits from ongoing collaborations with the Natural Resources Defense Council and number of Canadian government scientists including Robyn Forrest, Sean Anderson and Daniel Duplisea.</p>
<p>Development of the features in the <a href="https://github.com/Blue-Matter/SAMtool/">SAMtool</a> package originated at the University of British Columbia in collaboration with the Natural Resources Defense Council. Further development has been funded by the Gordon and Betty Moore Foundation, the Packard Foundation, U.S. National Oceanic and Atmospheric Administration, Fisheries and Oceans Canada, the Walton Foundation, Resources Legacy Fund, the Natural Resources Defense Council, the United Nations Food and Agricultural Organization and the California Department of Fish and Wildlife.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Quang Huynh, Tom Carruthers, Adrian Hordyk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
