<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2a. Mathematical description of the RCM • SAMtool</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2a. Mathematical description of the RCM">
<meta property="og:description" content="SAMtool">
<meta property="og:image" content="https://SAMtool.openMSE.com/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SAMtool</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/SAMtool.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Delay_difference.html">1a. Delay-difference and delay-differential models</a>
    </li>
    <li>
      <a href="../articles/RCM.html">2. Description of the RCM (Rapid Conditioning Model) for conditioning MSEtool operating models</a>
    </li>
    <li>
      <a href="../articles/RCM_eq.html">2a. Mathematical description of the RCM</a>
    </li>
    <li>
      <a href="../articles/RCM_sel.html">2b. Configuring selectivity for the RCM</a>
    </li>
    <li>
      <a href="../articles/SCA.html">1b. Statistical catch-at-age (SCA) model</a>
    </li>
    <li>
      <a href="../articles/Surplus_production.html">1c. Surplus production model</a>
    </li>
    <li>
      <a href="../articles/VPA.html">1d. Virtual population analysis (VPA)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Blue-Matter/SAMtool/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="RCM_eq_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2a. Mathematical description of the RCM</h1>
                        <h4 class="author">Quang Huynh (<a href="mailto:quang@bluematterscience.com" class="email">quang@bluematterscience.com</a>)</h4>
            
            <h4 class="date">2021-02-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Blue-Matter/SAMtool/blob/master/vignettes/RCM_eq.Rmd"><code>vignettes/RCM_eq.Rmd</code></a></small>
      <div class="hidden name"><code>RCM_eq.Rmd</code></div>

    </div>

    
    
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"} } });
</script><style type="text/css">

body{ /* Normal  */
   font-size: 12px;
}
td {  /* Table  */
   font-size: 8px;
}
h1 { /* Header 1 */
 font-size: 18px;
 color: DarkBlue;
}
h2 { /* Header 2 */
 font-size: 15px;
 color: DarkBlue;
}
h3 { /* Header 3 */
 font-size: 14px;
 color: DarkBlue;
}
code.r{ /* Code block */
  font-size: 10px;
}
pre { /* Code block */
  font-size: 10px
}
</style>
<p><br></p>
<div id="selectivity-and-mortality" class="section level1">
<h1 class="hasAnchor">
<a href="#selectivity-and-mortality" class="anchor"></a>Selectivity and mortality</h1>
<p>For fleets, selectivity is defined by blocks (indexed by <span class="math inline">\(b\)</span>) which can then be assigned to any fleet <span class="math inline">\(f\)</span> and year <span class="math inline">\(y\)</span> to allow for time-varying selectivity. By default, each fleet is assigned to its own block for all years (no time-varying selectivity).</p>
<p>For flat-topped selectivity in block <span class="math inline">\(b\)</span>, two parameters are used and expressed in terms of length units: the length of 5% selectivity (<span class="math inline">\(L^5_b\)</span>) and the length of full selectivity <span class="math inline">\(L^{\textrm{FS}}_b\)</span>. For dome selectivity, a third parameter, the selectivity at <span class="math inline">\(L_{\infty}\)</span>, <span class="math inline">\(V^{L_{\infty}}_b\)</span> is also used. Length-based selectivity is converted to age-based selectivity in the age-structured model as:</p>
<p><span class="math display">\[ v_{y,a,b} = 
\begin{cases}
2^{-[(L_{y,a} - L^{\textrm{FS}}_b)/(\sigma^{\textrm{asc}}_b)]^2} &amp; \textrm{if } L_{y,a} &lt; L^{\textrm{FS}}_b\\ 
1 &amp; \textrm{if logistic and } L_{y,a} \ge L^{\textrm{FS}}_b,\\
2^{-[(L_{y,a} - L^{\textrm{FS}}_b)/(\sigma^{\textrm{des}}_b)]^2} &amp; \textrm{if dome and } L_{y,a} \ge L^{\textrm{FS}}_b
\end{cases}
\]</span></p>
<p>where <span class="math inline">\(L_{y,a}\)</span> is the mean length-at-age and <span class="math inline">\(\sigma^{\textrm{asc}}_b = (L^5_b - L^{\textrm{FS}}_b)/\sqrt{-\log_2(0.05)}\)</span> and <span class="math inline">\(\sigma^{\textrm{des}}_b = (L_{\infty} - L^{\textrm{FS}}_b)/\sqrt{-\log_2(V^{L_{\infty}}_b)}\)</span> control the shape of the ascending and descending limbs, respectively, of the selectivity function. In this parameterization, length-based selectivity is constant over time. The corresponding age-based selectivity within each block is constant so long as growth is not time-varying.</p>
<p>Selectivity can also be parameterized where <span class="math inline">\(v_{y,a,b}\)</span> are free independent parameters. In this case, selectivity does not vary among years.</p>
<p>Total mortality <span class="math inline">\(Z\)</span> in year <span class="math inline">\(y\)</span> and for age <span class="math inline">\(a\)</span> is the sum of fishing mortality <span class="math inline">\(F\)</span> from all fleets and natural mortality <span class="math inline">\(M\)</span>,</p>
<p><span class="math display">\[ Z_{y,a} = M_{y,a} + \Sigma_f v_{y,a,f} F_{y,f},\]</span></p>
<p>where <span class="math inline">\(v_{y,a,f}\)</span> is the fleet selectivity after assigning blocks to fleets.</p>
</div>
<div id="survey-selectivity" class="section level1">
<h1 class="hasAnchor">
<a href="#survey-selectivity" class="anchor"></a>Survey selectivity</h1>
<p>Survey selectivity is constant over time and is denoted as <span class="math inline">\(v_{a,s}\)</span> with either logistic, dome, or free parameterizations.</p>
</div>
<div id="initial-population-distribution" class="section level1">
<h1 class="hasAnchor">
<a href="#initial-population-distribution" class="anchor"></a>Initial population distribution</h1>
<p>The population age distribution in the first year of the model <span class="math inline">\(y=1\)</span> is in equilibrium where <span class="math display">\[ N_{1,a} = 
\begin{cases}
      R^{\textrm{eq}} \exp(-\Sigma_{i=1}^{a-1}Z^{\textrm{eq}}_i) &amp; a = 1, \ldots, A-1\\
      \dfrac{R^{\textrm{eq}} \exp(-\Sigma_{i=1}^{a-1}Z^{\textrm{eq}}_i)}{1 - \exp(-Z^{\textrm{eq}}_A)} &amp; a = A,
\end{cases}
\]</span> where the <span class="math inline">\(R^{\textrm{eq}}\)</span> is the equilibrium recruitment and <span class="math inline">\(Z^{\textrm{eq}}_a = M_{1,a} + \Sigma_f v_{1,a,f} F^{\textrm{eq}}_f\)</span> is the equilibrium total mortality rate. Unfished conditions are modeled by setting <span class="math inline">\(F^{\textrm{eq}}_f = 0\)</span>. To estimate <span class="math inline">\(F^{\textrm{eq}}_f\)</span>, the corresponding equilibrium catch in weight <span class="math inline">\(Y^{\textrm{eq}}_f\)</span> prior to the first year of the model should be provided. In the equilibrium yield curve, <span class="math inline">\(F^{\textrm{eq}}_f\)</span> would be the fishing mortality corresponding to fishing at <span class="math inline">\(F^{\textrm{eq}}_f\)</span>. Once <span class="math inline">\(Z^{\textrm{eq}}_a\)</span> is obtained, then the equilibrium recruitment is calculated as:</p>
<p><span class="math display">\[ R^{\textrm{eq}} = 
\begin{cases}
      \dfrac{\alpha^{\textrm{B}}\phi^{\textrm{eq}} - 1}{\beta^{\textrm{B}}\phi^{\textrm{eq}}} &amp; \textrm{if Beverton-Holt stock-recruit relationship}\\
      \dfrac{\log(\alpha^{\textrm{R}}\phi^{\textrm{eq}})}{\beta^{\textrm{R}}\phi^{\textrm{eq}}} &amp; \textrm{if Ricker stock-recruit relationship}
\end{cases},
\]</span> where <span class="math inline">\(\phi^{\textrm{eq}}\)</span> is the spawners-per-recruit when the mortality is <span class="math inline">\(Z^{\textrm{eq}}_a\)</span>. From steepness <span class="math inline">\(h\)</span>, <span class="math inline">\(\alpha^{\textrm{B}} = \frac{4h}{(1-h)\phi_0}\)</span>, <span class="math inline">\(\beta^{\textrm{B}} = \frac{5h-1}{(1-h)B^S_0}\)</span>, <span class="math inline">\(\alpha^{\textrm{R}} = \frac{(5h)^{1.25}}{\phi_0}\)</span>, <span class="math inline">\(\beta^{\textrm{R}} = \frac{\log(5h)}{B^S_0}\)</span>, where <span class="math inline">\(\phi_0\)</span> and <span class="math inline">\(B^S_0\)</span> are unfished spawners-per-recruit and unfished spawning biomass, respectively.</p>
</div>
<div id="dynamics-equations" class="section level1">
<h1 class="hasAnchor">
<a href="#dynamics-equations" class="anchor"></a>Dynamics equations</h1>
<p>After setting the equilibrium population age distribution in the first year of the model, the population abundance <span class="math inline">\(N_{y,a}\)</span> in subsequent years is <span class="math display">\[ N_{y,a} =
\begin{cases}
      R_y &amp; a = 1\\
      N_{y-1,a-1} \exp(-Z_{y-1,a-1}) &amp; a = 2, \ldots, A - 1,\\
      N_{y-1,a-1} \exp(-Z_{y-1,a-1}) + N_{y-1,a} \exp(-Z_{y-1,a}) &amp; a = A
\end{cases}
\]</span> where <span class="math inline">\(R_y\)</span> is the recruitment and <span class="math inline">\(A\)</span> is the maximum-age as the plus-group. Recruitment is modelled as <span class="math display">\[ R_y = 
\begin{cases}
      \dfrac{\alpha^{\textrm{BH}} B^S_{y-1}}{1 + \beta^{\textrm{BH}}B^S_{y-1}} \exp(\delta_y - 0.5 \tau^2) &amp; \textrm{if Beverton-Holt stock-recruit relationship}\\
      \alpha^{\textrm{Ricker}} B^S_{y-1} \exp(-\beta^{\textrm{Ricker}} B^S_{y-1})\exp(\delta_y - 0.5 \tau^2) &amp; \textrm{if Ricker stock-recruit relationship}
\end{cases},
\]</span> where <span class="math inline">\(\delta_y\)</span> are recruitment deviates and <span class="math inline">\(\tau\)</span> is the standard deviation of the deviates.</p>
<p>The spawning biomass is <span class="math inline">\(B^S_y\)</span> is <span class="math display">\[B^S_y = \sum_a w_{y,a} m_{y,a} N_{y,a},\]</span> where <span class="math inline">\(m_{y,a}\)</span> and <span class="math inline">\(w_{y,a}\)</span> are the maturity at age and weight at age, respectively.</p>
</div>
<div id="catch-at-age" class="section level1">
<h1 class="hasAnchor">
<a href="#catch-at-age" class="anchor"></a>Catch at age</h1>
<p>The catch (in numbers) <span class="math inline">\(C\)</span> at age for fleet <span class="math inline">\(f\)</span> is <span class="math display">\[ C_{y,a,f} = \dfrac{v_{y,a,f} F_{y,f}}{Z_{y,a}} N_{y,a} (1 - \exp[-Z_{y,a}]).\]</span></p>
<p>If the model is conditioned on catch, then <span class="math inline">\(F_{y,f}\)</span> can be estimated as parameters or solved iteratively to match the observed catch. If the model is conditioned on effort, then <span class="math display">\[ F_{y,f} = q_f E_{y,f},\]</span> where <span class="math inline">\(E_{y,f}\)</span> is the observed effort and <span class="math inline">\(q_f\)</span> is the scaling coefficient.</p>
<p>The proportion of the catch-at-age is <span class="math display">\[ p_{y,a,f} = \dfrac{C_{y,a,f}}{\sum_a C_{y,a,f}}.\]</span></p>
</div>
<div id="catch-at-length" class="section level1">
<h1 class="hasAnchor">
<a href="#catch-at-length" class="anchor"></a>Catch-at-length</h1>
<p>The catch at length is calculated assuming a normally distributed length-at-age <span class="math inline">\(P(\ell,a)\)</span>, where <span class="math display">\[ C_{y,\ell,f} = \sum_a C_{y,a,f} P(\ell|a) \]</span> and</p>
<p><span class="math display">\[ P(\ell|a) = 
\begin{cases}
      \phi(L'_{\ell+1}) &amp; \ell = 1\\
      \phi(L'_{\ell+1}) - \phi(L'_\ell) &amp; \ell = 2, \ldots, L - 1,\\
      1 -\phi(L'_\ell) &amp; \ell = L
\end{cases}
\]</span> with <span class="math inline">\(L'_{\ell}\)</span> as the length at the lower boundary of length bin <span class="math inline">\(\ell\)</span> and <span class="math inline">\(\phi(L'_{\ell})\)</span> as the cumulative distribution function of a normal variable with mean <span class="math inline">\(\tilde{L}_{y,a}\)</span> (the expected mean length at age <span class="math inline">\(a\)</span>) and standard deviation <span class="math inline">\(\tilde{L}_{y,a} \times CV^L\)</span> (<span class="math inline">\(CV^L\)</span> is the coefficient of variation in mean length at age).</p>
<p>The proportion of the catch-at-length is <span class="math display">\[ p_{y,\ell,f} = \dfrac{C_{y,\ell,f}}{\sum_{\ell}C_{y,\ell,f}}.\]</span></p>
</div>
<div id="catch-in-weight" class="section level1">
<h1 class="hasAnchor">
<a href="#catch-in-weight" class="anchor"></a>Catch in weight</h1>
<p>The catch in weight <span class="math inline">\(Y\)</span> is <span class="math display">\[ Y_{y,f} = \sum_a C_{y,a,f} w_{y,a}.\]</span></p>
</div>
<div id="mean-size" class="section level1">
<h1 class="hasAnchor">
<a href="#mean-size" class="anchor"></a>Mean size</h1>
<p>The mean length of the catch <span class="math inline">\(\bar{L}_{y,f}\)</span> is <span class="math display">\[ \bar{L}_{y,f} = \dfrac{\sum_{\ell} L_{\ell} C_{y,\ell,f}}{\sum_{\ell} C_{y,\ell,f}},\]</span> where <span class="math inline">\(L_\ell\)</span> is the midpoint of the length bin <span class="math inline">\(\ell\)</span>.</p>
<p>The mean weight of the catch <span class="math inline">\(\bar{w}_{y,f}\)</span> is <span class="math display">\[ \bar{w}_{y,f} = \dfrac{\sum_a C_{y,a,f}w_{y,a}}{\sum_a C_{y,a,f}},\]</span></p>
</div>
<div id="survey" class="section level1">
<h1 class="hasAnchor">
<a href="#survey" class="anchor"></a>Survey</h1>
<p>If the <span class="math inline">\(s^{\textrm{th}}\)</span> survey is biomass-based, then the survey value <span class="math inline">\(I_{y,s}\)</span> is calculated as <span class="math display">\[ I_{y,s} = q_s \sum_a v_{y,a,s} N_{y,a} w_{y,a}, \]</span> where <span class="math inline">\(q\)</span> is the scaling coefficient and <span class="math inline">\(s\)</span> indexes survey.</p>
<p>If the survey is abundance-based, then <span class="math display">\[ I_{y,s} = q_s \sum_a v_{y,a,s} N_{y,a} . \]</span></p>
<p>The proportion-at-age vulnerable to the survey is <span class="math display">\[ p_{y,a,s} = \dfrac{v_{a,s}N_{y,a}}{\sum_a v_{a,s}N_{y,a}}.\]</span></p>
<p>The proportion-at-length vulnerable to the survey is <span class="math display">\[ p_{y,\ell,s} = \dfrac{\sum_a v_{a,s} N_{y,a} P(\ell|a)}{\sum_{\ell} \sum_a v_{a,s} N_{y,a} P(\ell|a)}.\]</span></p>
</div>
<div id="estimated-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#estimated-parameters" class="anchor"></a>Estimated parameters</h1>
<p>The estimated parameters, denoted in this section as <span class="math inline">\(x\)</span>, are unconstrained over all real numbers and then transformed in order to constrain the corresponding model parameters. For optimization, the transformation is also designed to reduce the scale of all estimated parameters to within an order of magnitude.</p>
<div id="selectivity" class="section level2">
<h2 class="hasAnchor">
<a href="#selectivity" class="anchor"></a>Selectivity</h2>
<p>For a fleet block <span class="math inline">\(b\)</span> for which selectivity is estimated, then parameters <span class="math inline">\(x^{LFS}_b\)</span> and <span class="math inline">\(x^{L5}_b\)</span> are estimated over all real numbers, where</p>
<p><span class="math display">\[ \begin{align}
L^{\textrm{FS}}_b &amp;= 0.99 \times L_{\infty} \times \textrm{logit}^{-1}(x^{LFS}_b)\\
L^5_b &amp;= L^{\textrm{FS}}_b - \exp(x^{L5}_b) 
\end{align}\]</span></p>
<p>If a third parameter <span class="math inline">\(x^{V}_b\)</span>is estimated for dome selectivity, then <span class="math display">\[ V^{L_{\infty}}_b = \textrm{logit}^{-1}(x^V_b)\]</span></p>
<p>If selectivity is parameterized as free parameters, then <span class="math display">\[ v_{y,a,f} = \textrm{logit}^{-1}(x^v_{y,a,f}).\]</span></p>
<p>For surveys, parameterizations are identical except with indexing for survey <span class="math inline">\(s\)</span>.</p>
</div>
<div id="fishing-mortality" class="section level2">
<h2 class="hasAnchor">
<a href="#fishing-mortality" class="anchor"></a>Fishing mortality</h2>
<p>If <span class="math inline">\(F_{y,f}\)</span> are estimated parameters (<code>condition = "catch"</code>), then one parameter <span class="math inline">\(x^F_f\)</span> is the estimated <span class="math inline">\(F\)</span> in log-space in the middle of the time series is estimated and all others are subsequent deviations, represented as <span class="math inline">\(x^{F_{dev}}_{y,f}\)</span>:</p>
<p><span class="math display">\[ F_{y,f} = 
\begin{cases}
\exp(x^F_f) &amp; y \textrm{ is midpoint of the time series}\\ 
\exp(x^F_f) \times \exp(x^{F_{dev}}_{y,f}) &amp; \textrm{otherwise}\\
\end{cases}
\]</span></p>
<p>If <code>condition = "effort"</code>, then <span class="math inline">\(q_f\)</span> is estimated in log space, where <span class="math display">\[F_{y,f} = q_f E_{y,f} = \exp(x^q_f) \times E_{y,f}\]</span></p>
</div>
<div id="index-catchability" class="section level2">
<h2 class="hasAnchor">
<a href="#index-catchability" class="anchor"></a>Index catchability</h2>
<p>To scale biomass to index values, the index catchability <span class="math inline">\(q_s\)</span> is solved analytically in the model:</p>
<p><span class="math display">\[ q_s = \exp\left(\dfrac{\sum_y \log(I^{\textrm{obs}}_{y,s}) - \sum_y \log(\sum_a v_{y,a,s}N_{y,a,s})}{n_s}\right),\]</span> or <span class="math display">\[ q_s = \exp\left(\dfrac{\sum_y \log(I^{\textrm{obs}}_{y,s}) - \sum_y \log(\sum_a v_{y,a,s}N_{y,a,s}w_{y,a})}{n_s}\right),\]</span> for an abundance or biomass based index, respectively, where <span class="math inline">\(n_s\)</span> is the number of years with index values and the summation is over those <span class="math inline">\(n_s\)</span> years.</p>
</div>
<div id="other-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#other-parameters" class="anchor"></a>Other parameters</h2>
<p>Unfished recruitment is estimated in log-space, <span class="math inline">\(R_0 = \dfrac{1}{z}\exp(x^{R_0})\)</span> where <span class="math inline">\(z\)</span> is an optional rescaler, e.g. mean historical catch, to reduce the magnitude of the <span class="math inline">\(x^{R_0}\)</span> estimate.</p>
<p>Recruitment deviations <span class="math inline">\(\delta_y\)</span> are estimated in log space.</p>
<p>The support of the steepness parameter <span class="math inline">\(x^h\)</span> is over all real numbers and is transformed. With the Beverton-Holt SR function: <span class="math display">\[ h = 0.8 \times \dfrac{1}{1 + \exp(-x^h)} + 0.2. \]</span> With a Ricker SR function: <span class="math display">\[ h = \exp(x^h) + 0.2.\]</span></p>
<p>Steepness is fixed unless a prior is used.</p>
<p>Age- and time-constant natural mortality <span class="math inline">\(M\)</span> can be estimated with a prior. Otherwise, it is fixed to values specified in the OM object. The parameter <span class="math inline">\(x^M\)</span> is estimated in log space.</p>
</div>
</div>
<div id="objective-function" class="section level1">
<h1 class="hasAnchor">
<a href="#objective-function" class="anchor"></a>Objective function</h1>
<div id="total-objective-function" class="section level2">
<h2 class="hasAnchor">
<a href="#total-objective-function" class="anchor"></a>Total objective function</h2>
<p>The total objective function <span class="math inline">\(\textrm{LL}\)</span> to be maximized is <span class="math display">\[\textrm{LL} = \sum_{i=1}^9\Lambda_i + \sum \textrm{pr} + \sum_y\sum_f\textrm{pen}_{y,f},\]</span></p>
<p>including the log likelihoods <span class="math inline">\(\Lambda_i\)</span>, logarithm of the parameter priors <span class="math inline">\(pr\)</span>, and penalty functions, described below.</p>
</div>
<div id="likelihoods" class="section level2">
<h2 class="hasAnchor">
<a href="#likelihoods" class="anchor"></a>Likelihoods</h2>
<p>If the model is conditioned on catch and fishing mortality rates are estimated parameters, then the log-likelihood component <span class="math inline">\(\Lambda_1\)</span> of the catch is <span class="math display">\[\Lambda_1 = \sum_f \left[\lambda^{Y}_f \sum_y \left(-\log(\omega_{y,f}) - \dfrac{[\log(Y^{\textrm{obs}}_{y,f}) - \log(Y^{\textrm{pred}}_{y,f})]^2}{2 \omega _{y,f}^2}\right)\right],\]</span></p>
<p>where <span class="math inline">\(\textrm{obs}\)</span> and <span class="math inline">\(\textrm{pred}\)</span> indicate observed and predicted quantities, respectively, <span class="math inline">\(\lambda\)</span> are likelihood weights, and <span class="math inline">\(\omega\)</span> is the catch standard deviation. With a small standard deviation for the catch likelihood relative to the variance in other likelihood components, i.e., <span class="math inline">\(\omega = 0.01\)</span>, the predicted catch should match the observed catch in the model.</p>
<p>The log-likelihood component <span class="math inline">\(\Lambda_2\)</span> of survey data is <span class="math display">\[\Lambda_2 = \sum_s \left[ \lambda^I_s \sum_y \left(-\log(\sigma_{y,s}) - \dfrac{[\log(I^{\textrm{obs}}_{y,s}) - \log(I^{\textrm{pred}}_{y,s})]^2}{2\sigma_{y,s}^2}\right) \right].\]</span></p>
<p>The log-likelihood component <span class="math inline">\(\Lambda_3\)</span> of catch-at-age data is <span class="math display">\[\Lambda_3 = \sum_f \lambda^A_f \left[\sum_y O^A_{y,f} \sum_a p^{\textrm{obs}}_{y,a,f} \log(p^{\textrm{pred}}_{y,a,f})\right],\]</span> where <span class="math inline">\(O^A\)</span> is the annual sample sizes for the age compositions.</p>
<p>The log-likelihood component <span class="math inline">\(\Lambda_4\)</span> of catch-at-length data is <span class="math display">\[\Lambda_4 = \sum_f \lambda^L_f \left[ \sum_y O^L_{y,f} \sum_{\ell} p^{\textrm{obs}}_{y,\ell,f} \log(p^{\textrm{pred}}_{y,\ell,f})\right]\]</span> where <span class="math inline">\(O^L\)</span> is the annual sample sizes for the length compositions.</p>
<p>The log-likelihood component <span class="math inline">\(\Lambda_5\)</span> for the observed mean size in this catch is:</p>
<p><span class="math display">\[\Lambda_5 = \sum_f \lambda^{\bar{L}}_f\left[ \sum_y \left(-\log(\eta_{y,f}) - \dfrac{[\bar{L}^{\textrm{obs}}_{y,f} - \bar{L}^{\textrm{pred}}_{y,f}]^2}{2 \eta^2_{y,f}}\right)\right],\]</span> for mean lengths, or</p>
<p><span class="math display">\[\Lambda_5 = \sum_f \lambda^{\bar{w}}_f\left[ \sum_y \left(-\log(\eta_{y,f}) - \dfrac{[\bar{w}^{\textrm{obs}}_{y,f} - \bar{w}^{\textrm{pred}}_{y,f}]^2}{2 \eta^2_{y,f}}\right)\right],\]</span> for mean weights, where <span class="math inline">\(\eta_{y,f}\)</span> is the standard deviation of the mean size. With constant coefficient of variation (CV), <span class="math inline">\(\eta_{y,f} = \bar{w}^{\textrm{obs}}_{y,f} CV^{\eta}_f\)</span>.</p>
<p>The log-likelihood component <span class="math inline">\(\Lambda_6\)</span> of annual estimated recruitment deviates <span class="math inline">\(\delta_y\)</span> in log space is <span class="math display">\[\Lambda_6 = \Sigma_y\left(-\log(\tau) - \dfrac{\delta_y^2}{2 \tau^2}\right),\]</span> where <span class="math inline">\(\tau\)</span> is the standard deviation of recruitment deviates.</p>
<p>The log-likelihood component <span class="math inline">\(\Lambda_7\)</span> of the equilibrium catch is <span class="math display">\[\Lambda_7 = \sum_f \lambda^{Y}_f \left(-\log(\omega^{\textrm{eq}}_f) - \dfrac{[\log(Y^{\textrm{eq,obs}}_f) - \log(Y^{\textrm{eq,pred}}_f)]^2}{2 \times (\omega^{\textrm{eq}}_f)^2}\right),\]</span></p>
<p>The log-likelihood component <span class="math inline">\(\Lambda_8\)</span> of the survey proportion-at-age data is <span class="math display">\[\Lambda_8 = \sum_s \lambda^{IA}_s \left[\sum_y O^{IA}_{y,s} \sum_a p^{\textrm{obs}}_{y,a,s} \log(p^{\textrm{pred}}_{y,a,s})\right],\]</span> where <span class="math inline">\(O^{IA}\)</span> is the annual sample sizes for the survey age compositions.</p>
<p>The log-likelihood component <span class="math inline">\(\Lambda_9\)</span> of the survey proportion-at-length data is <span class="math display">\[\Lambda_9 = \sum_s \lambda^{IL}_s \left[ \sum_y O^{IL}_{y,s} \sum_{\ell} p^{\textrm{obs}}_{y,\ell,s} \log(p^{\textrm{pred}}_{y,\ell,s})\right]\]</span> where <span class="math inline">\(O^{IL}\)</span> is the annual sample sizes for the survey length compositions.</p>
</div>
<div id="priors" class="section level2">
<h2 class="hasAnchor">
<a href="#priors" class="anchor"></a>Priors</h2>
<p>Vague priors are added to selectivity parameters to aid in convergence, with <span class="math display">\[ \begin{align}
x^{\textrm{LFS}}_b &amp;\sim N(0,3)\\
x^{\textrm{L5}}_b &amp;\sim N(0,3)\\
V^{L_{\infty}}_b &amp;\sim \textrm{Beta}(1.01, 1.01)
\end{align}\]</span></p>
<p>If free selectivity parameters are estimated, then <span class="math display">\[v_{y,a,f} \sim \textrm{Beta}(1.01, 1.01)\]</span></p>
</div>
<div id="optional-priors" class="section level2">
<h2 class="hasAnchor">
<a href="#optional-priors" class="anchor"></a>Optional priors</h2>
<p>A lognormal prior on <span class="math inline">\(R_0\)</span> can be specified. The penalty term <span class="math inline">\(\textrm{pr}\)</span> to the objective function is: <span class="math display">\[\textrm{pr}^{R_0} = -\log(\sigma^{R_0}) - 0.5\left[\dfrac{\log(R_0/\mu^{R_0})}{\sigma^{R_0}}\right]^2,\]</span> where <span class="math inline">\(\mu^{R_0}\)</span> and <span class="math inline">\(\sigma^{R_0}\)</span> are the mean and standard deviations for the prior provided by the user.</p>
<p>Recall that the parameter corresponding to Beverton-Holt steepness <span class="math inline">\(x^h\)</span> is estimable over all real numbers and is transformed such that <span class="math inline">\(h = 0.8 \times \textrm{logit}^{-1}(x^h) + 0.2\)</span>. The prior uses a beta distribution on <span class="math inline">\(y = (h - 0.2)/0.8\)</span>. The penalty to the objective function is: <span class="math display">\[\textrm{pr}^{h} = \log(y) (\alpha-1) + \log(1-y) * (\beta-1) - \log(y - y^2),\]</span> where <span class="math inline">\(\alpha = \mu^h \left(\frac{\mu^h (1 - \mu^h)}{(\sigma^h)^2} - 1\right)\)</span>, <span class="math inline">\(\beta = (1-\mu^h)\left(\frac{\mu^h (1 - \mu^h)}{(\sigma^h)^2} - 1\right)\)</span>, and the last term is the log Jacobian transform of the logit function.</p>
<p>With a Ricker SR function, a normal distribution is used: <span class="math display">\[\textrm{pr}^{h} = -\log(\sigma^{h}) - 0.5\left(\dfrac{h - \mu^{h}}{\sigma^{h}}\right)^2.\]</span></p>
<p>The prior for <span class="math inline">\(M\)</span> is lognormal: <span class="math display">\[\textrm{pr}^{M} = -\log(\sigma^{M}) - 0.5\left[\dfrac{\log(M/\mu^{M})}{\sigma^{M}}\right]^2.\]</span></p>
<p>Priors for survey catchability <span class="math inline">\(q_s\)</span> are normally distributed: <span class="math display">\[\textrm{pr}^{q} = \sum_s\left(-\log(\sigma^{q}_s) - 0.5\left(\dfrac{q_s - \mu^{q}_s}{\sigma^{q}_s}\right)^2\right).\]</span></p>
</div>
<div id="penalties" class="section level2">
<h2 class="hasAnchor">
<a href="#penalties" class="anchor"></a>Penalties</h2>
<p>A penalty to the likelihood is added when <span class="math inline">\(F_{y,f} \ge F_{\textrm{max}}\)</span> for any year and fleet. The penalty is</p>
<p><span class="math display">\[\textrm{pen}_{y,f} = 
\begin{cases}
0.01 (F_{y,f} - F_{\textrm{max}})^2 &amp; F_{y,f} \ge F_{\textrm{max}}\\ 
0 &amp; \textrm{otherwise}
\end{cases}.\]</span></p>
</div>
</div>
<div id="additional-resources" class="section level1">
<h1 class="hasAnchor">
<a href="#additional-resources" class="anchor"></a>Additional resources</h1>
<p>The help file for <code>RCM</code> will provide more information on the possible inputs for the model. The help file for the RCModel class (obtained by typing <code><a href="../reference/RCModel-class.html">class?RCModel</a></code> into the R console) describes the outputs from the function. An additional <a href="RCM_sel.html">vignette</a> is available to describe set up of fleet and survey selectivity in the function call.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Quang Huynh, Tom Carruthers, Adrian Hordyk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
