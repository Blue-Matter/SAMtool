<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Rapid Conditioning Model (RCM) — check_RCMdata • SAMtool</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Rapid Conditioning Model (RCM) — check_RCMdata" />
<meta property="og:description" content="Intended for conditioning operating models for MSEtool. For data-limited stocks, this function can generate a range of potential depletion scenarios inferred from sparse data.
From a historical time series of total catch or effort, and potentially age/length compositions and multiple indices of abundance, the RCM returns a range of values for depletion, selectivity,
unfished recruitment (R0), historical fishing effort, and recruitment deviations for the operating model. This is done by sampling life history parameters
provided by the user and fitting a statistical catch-at-age model (with the predicted catch equal to the observed catch).
Alternatively one can do a single model fit and sample the covariance matrix to generate an operating model with uncertainty based on the model fit.
Either a full catch (conditioned on catch) or effort (conditioned on effort) time series is needed but missing data (as NAs) are allowed for all other data types.
check_RCMdata evaluates whether the inputs in the S4 RCMdata object are correctly formatted." />
<meta property="og:image" content="https://SAMtool.openMSE.com/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SAMtool</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/SAMtool.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Blue-Matter/SAMtool/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Rapid Conditioning Model (RCM)</h1>
    <small class="dont-index">Source: <a href='https://github.com/Blue-Matter/SAMtool/blob/master/R/RCM_data.R'><code>R/RCM_data.R</code></a>, <a href='https://github.com/Blue-Matter/SAMtool/blob/master/R/define_S4_generic_RCM.R'><code>R/define_S4_generic_RCM.R</code></a></small>
    <div class="hidden name"><code>RCM.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Intended for conditioning operating models for MSEtool. For data-limited stocks, this function can generate a range of potential depletion scenarios inferred from sparse data.
From a historical time series of total catch or effort, and potentially age/length compositions and multiple indices of abundance, the RCM returns a range of values for depletion, selectivity,
unfished recruitment (R0), historical fishing effort, and recruitment deviations for the operating model. This is done by sampling life history parameters
provided by the user and fitting a statistical catch-at-age model (with the predicted catch equal to the observed catch).
Alternatively one can do a single model fit and sample the covariance matrix to generate an operating model with uncertainty based on the model fit.
Either a full catch (conditioned on catch) or effort (conditioned on effort) time series is needed but missing data (as NAs) are allowed for all other data types.
<code>check_RCMdata</code> evaluates whether the inputs in the S4 RCMdata object are correctly formatted.</p>
    </div>

    <pre class="usage"><span class='fu'>check_RCMdata</span><span class='op'>(</span><span class='va'>RCMdata</span>, <span class='va'>OM</span>, condition <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"catch"</span>, <span class='st'>"catch2"</span>, <span class='st'>"effort"</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>RCM</span><span class='op'>(</span><span class='va'>OM</span>, <span class='va'>data</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S4 method for OM,RCMdata</span>
<span class='fu'>RCM</span><span class='op'>(</span>
  <span class='va'>OM</span>,
  <span class='va'>data</span>,
  condition <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"catch"</span>, <span class='st'>"catch2"</span>, <span class='st'>"effort"</span><span class='op'>)</span>,
  selectivity <span class='op'>=</span> <span class='st'>"logistic"</span>,
  s_selectivity <span class='op'>=</span> <span class='cn'>NULL</span>,
  LWT <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  comp_like <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"multinomial"</span>, <span class='st'>"lognormal"</span><span class='op'>)</span>,
  prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  max_F <span class='op'>=</span> <span class='fl'>3</span>,
  cores <span class='op'>=</span> <span class='fl'>1L</span>,
  integrate <span class='op'>=</span> <span class='cn'>FALSE</span>,
  mean_fit <span class='op'>=</span> <span class='cn'>FALSE</span>,
  drop_nonconv <span class='op'>=</span> <span class='cn'>FALSE</span>,
  drop_highF <span class='op'>=</span> <span class='cn'>FALSE</span>,
  control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>iter.max <span class='op'>=</span> <span class='fl'>2e+05</span>, eval.max <span class='op'>=</span> <span class='fl'>4e+05</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S4 method for OM,list</span>
<span class='fu'>RCM</span><span class='op'>(</span>
  <span class='va'>OM</span>,
  <span class='va'>data</span>,
  condition <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"catch"</span>, <span class='st'>"catch2"</span>, <span class='st'>"effort"</span><span class='op'>)</span>,
  selectivity <span class='op'>=</span> <span class='st'>"logistic"</span>,
  s_selectivity <span class='op'>=</span> <span class='cn'>NULL</span>,
  LWT <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  comp_like <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"multinomial"</span>, <span class='st'>"lognormal"</span><span class='op'>)</span>,
  ESS <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>30</span>, <span class='fl'>30</span><span class='op'>)</span>,
  prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  max_F <span class='op'>=</span> <span class='fl'>3</span>,
  cores <span class='op'>=</span> <span class='fl'>1L</span>,
  integrate <span class='op'>=</span> <span class='cn'>FALSE</span>,
  mean_fit <span class='op'>=</span> <span class='cn'>FALSE</span>,
  drop_nonconv <span class='op'>=</span> <span class='cn'>FALSE</span>,
  drop_highF <span class='op'>=</span> <span class='cn'>FALSE</span>,
  control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>iter.max <span class='op'>=</span> <span class='fl'>2e+05</span>, eval.max <span class='op'>=</span> <span class='fl'>4e+05</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S4 method for OM,Data</span>
<span class='fu'>RCM</span><span class='op'>(</span>
  <span class='va'>OM</span>,
  <span class='va'>data</span>,
  condition <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"catch"</span>, <span class='st'>"catch2"</span>, <span class='st'>"effort"</span><span class='op'>)</span>,
  selectivity <span class='op'>=</span> <span class='st'>"logistic"</span>,
  s_selectivity <span class='op'>=</span> <span class='cn'>NULL</span>,
  LWT <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  comp_like <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"multinomial"</span>, <span class='st'>"lognormal"</span><span class='op'>)</span>,
  ESS <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>30</span>, <span class='fl'>30</span><span class='op'>)</span>,
  prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  max_F <span class='op'>=</span> <span class='fl'>3</span>,
  cores <span class='op'>=</span> <span class='fl'>1L</span>,
  integrate <span class='op'>=</span> <span class='cn'>FALSE</span>,
  mean_fit <span class='op'>=</span> <span class='cn'>FALSE</span>,
  drop_nonconv <span class='op'>=</span> <span class='cn'>FALSE</span>,
  drop_highF <span class='op'>=</span> <span class='cn'>FALSE</span>,
  control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>iter.max <span class='op'>=</span> <span class='fl'>2e+05</span>, eval.max <span class='op'>=</span> <span class='fl'>4e+05</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>RCMdata</th>
      <td><p>An <a href='RCMdata-class.html'>RCMdata</a> object.</p></td>
    </tr>
    <tr>
      <th>OM</th>
      <td><p>An object of class OM that specifies natural mortality (M), growth (Linf, K, t0, a, b), stock-recruitment relationship,
steepness, maturity parameters (L50 and L50_95), standard deviation of recruitment variability (Perr), as well as index uncertainty (Iobs).</p></td>
    </tr>
    <tr>
      <th>condition</th>
      <td><p>String to indicate whether the RCM is conditioned on "catch" (where F are estimated parameters), "catch2" (where F is solved internally using Newton's method),
or "effort".</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>Data inputs formatted in a <a href='RCMdata-class.html'>RCMdata</a> (preferred) or Data object. 
Use of a list is deprecated. See Data section below.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other arguments to pass in for starting values of parameters and fixing parameters. See details.</p></td>
    </tr>
    <tr>
      <th>selectivity</th>
      <td><p>A character vector of length nfleet to indicate <code>"logistic"</code>, <code>"dome"</code>, or <code>"free"</code> selectivity for each fleet in <code>Chist</code>.
If there is time-varying selectivity, this is a character vector of length nsel_block (see Data section below). "free" indicates independent selectivity parameters for each age,
and additional modifications for fixing selectivity parameters will likely be needed. See Additional arguments section.</p></td>
    </tr>
    <tr>
      <th>s_selectivity</th>
      <td><p>A vector of length nsurvey to indicate the selectivity of the corresponding columns in <code>data$Index</code>. Use <code>"B"</code> for
total biomass, or <code>"SSB"</code> for spawning biomass (by default, "B" is used). Use numbers if the survey selectivity follows a fleet (corresponding to the columns in data$Chist, e.g., 1 = first fleet/column and so on).
If the survey selectivity is otherwise independent of anything else in the model, use <code>"logistic"</code>, <code>"dome"</code>, or <code>"free"</code> to specify the functional form of selectivity, and
see Additional arguments section for setup of survey selectivity parameters and Articles section for more information.</p></td>
    </tr>
    <tr>
      <th>LWT</th>
      <td><p>A named list of likelihood weights for the RCM. See below.</p></td>
    </tr>
    <tr>
      <th>comp_like</th>
      <td><p>A string indicating either <code>"multinomial"</code> (default) or <code>"lognormal"</code> distributions for the composition data.</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>A named list (R0, h, M, and q) to provide the mean and standard deviations of prior distributions for those parameters. R0, index q, and M priors are
lognormal (provide the mean in normal space, SD in lognormal space). Beverton-Holt steepness uses a beta prior, while Ricker steepness uses a normal prior.
For index q, provide a matrix for nsurvey rows and 2 columns (for mean and SD), with NA in rows corresponding to indices without priors. For all others, provide a length-2 vector for the mean and SD.
See Articles section for full description.</p></td>
    </tr>
    <tr>
      <th>max_F</th>
      <td><p>The maximum F for any fleet in the scoping model (higher F's in the model are penalized in the objective function). See also <code>drop_highF</code>.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>Integer for the number of CPU cores for the stock reduction analysis.</p></td>
    </tr>
    <tr>
      <th>integrate</th>
      <td><p>Logical, whether to treat recruitment deviations as penalized parameters in the likelihood (FALSE) or random effects to be marginalized out of the likelihood (TRUE).</p></td>
    </tr>
    <tr>
      <th>mean_fit</th>
      <td><p>Logical, whether to run an additional with mean values of life history parameters from the OM.</p></td>
    </tr>
    <tr>
      <th>drop_nonconv</th>
      <td><p>Logical, whether to drop non-converged fits of the RCM, including fits where F = NA.</p></td>
    </tr>
    <tr>
      <th>drop_highF</th>
      <td><p>Logical, whether to drop fits of the RCM where F = <code>max_F</code>.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>A named list of arguments (e.g, max. iterations, etc.) for optimization, to be passed to the control argument of <code><a href='https://rdrr.io/r/stats/nlminb.html'>nlminb</a></code>.</p></td>
    </tr>
    <tr>
      <th>ESS</th>
      <td><p>A vector of length two. A shortcut method to setting the maximum multinomial sample size of the age and length compositions. 
Not used when data are provided in a <a href='RCMdata-class.html'>RCMdata</a> object.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <a href='RCModel-class.html'>RCModel</a> (see link for description of output).</p>
<p><code>check_RCMdata</code> returns a list of updated RCMdata object, OM, and StockPars, ObsPars, and FleetPars from the Hist object generated
from the OM.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Fleet selectivity is fixed to values sampled from <code>OM</code> if no age or length compositions are provided.</p>
<p>Survey selectivity is estimable only if <code>IAA</code> or <code>IAL</code> is provided. Otherwise, the selectivity should
be mirrored to a fleet (vulnerable biomass selectivity) or indexed to total or spawning biomass (see <code>s_selectivity</code>).</p>
<p>Parameters that were used in the fitting model are placed in the <code>RCM@OM@cpars</code> list.</p>
<p>If the operating model <code>OM</code> uses time-varying growth or M, then those trends will be used in the RCM as well.
Non-stationary productivity creates ambiguity in the calculation and interpretation of depletion and MSY reference points.</p>
<p>The easiest way to turn off time-varying growth/M is by setting: <code>OM@Msd &lt;- OM@Linfsd &lt;- OM@Ksd &lt;- c(0, 0)</code>.</p>
<p>To play with alternative fits by excluding indices, for example, or other optional data, set the corresponding likelihood weight to zero. The model will still generate the inferred
index but the data won't enter the likelihood. See section on likelihood weights.</p>
    <h2 class="hasAnchor" id="online-documentation"><a class="anchor" href="#online-documentation"></a>Online Documentation</h2>

    

<p>Several articles are available for the RCM:</p>
<ul>
<li><p><a href='https://openmse.com/tutorial-rcm/'>General overview of approach</a></p></li>
<li><p><a href='https://openmse.com/tutorial-rcm-eq/'>Mathematical description</a></p></li>
<li><p><a href='https://openmse.com/tutorial-rcm-select/'>Setup of selectivity settings</a> (useful for more data-rich cases)</p></li>
<li><p><a href='https://openmse.com/features-assessment-models/5-priors/'>Description of priors</a></p></li>
</ul>

    <h2 class="hasAnchor" id="data"><a class="anchor" href="#data"></a>Data</h2>

    

<p>One of indices, age compositions, or length compositions should be provided in addition to the historical catch or effort. Not all arguments
are needed to run the model (some have defaults, while others are ignored if not applicable depending on the data provided).</p>
<p>The <code>data</code> variable can be an object of class <a href='RCMdata-class.html'>RCMdata</a>. See help file for description of inputs.</p>
<p>Alternatively, the <code>data</code> input can be a Data S4 object which will retrieve data from the following slots:</p>
<ul>
<li><p>Data@Cat - catch series (single fleet with the Data S4 object)</p></li>
<li><p>Data@Effort - effort series</p></li>
<li><p>Data@CAA - fishery age composition</p></li>
<li><p>Data@CAL, Data@CAL_mids - fishery length composition and corresponding length bins</p></li>
<li><p>Data@Ind, Data@SpInd, Data@VInd, Data@AddInd - indices of abundance</p></li>
<li><p>Data@CV_Ind, Data@CV_SpInd, Data@CV_VInd, Data@CV_AddInd - annual coefficients of variation for the corresponding indices of abundance. CVs will be converted to lognormal standard deviations.</p></li>
<li><p>Data@ML - fishery mean lengths</p></li>
<li><p>Data@AddIndV, Data@AddIndType, Data@AddIunits - Additional information for indices in Data@AddInd: selectivity and units (i.e., biomass or abundance).</p></li>
</ul>

<p>There is no slot in the Data S4 object for the equilibrium catch/effort. These can be passed directly in the function call, i.e., <code>RCM(OM, Data, C_eq = C_eq, ...)</code>.</p>
<p>Use of a list is deprecated. For backwards compatibility, here is the list of supported entries:</p>
<ul>
<li><p>Chist - A vector of historical catch, should be of length OM@nyears. If there are multiple fleets: a matrix of OM@nyears rows and nfleet columns.
Ideally, the first year of the catch series represents unfished conditions (see also <code>C_eq</code>).</p></li>
<li><p>C_sd - A vector or matrix of standard deviations (lognormal distribution) for the catches in <code>Chist</code>.
If not provided, the default is 0.01. Only used if <code>condition = "catch"</code>.</p></li>
<li><p>Ehist - A vector of historical effort, should be of length OM@nyears (see also <code>E_eq</code>).</p></li>
<li><p>Index - A vector of values of an index (of length OM@nyears). If there are multiple indices: a matrix of historical indices of abundances, with rows
indexing years and columns indexing the index.</p></li>
<li><p>I_sd - A vector or matrix of standard deviations (lognormal distribution) for the indices corresponding to the entries in <code>Index</code>.
If not provided, this function will use values from <code>OM@Iobs</code>.</p></li>
<li><p>I_type - Obsolete as of version 2.0. See <code>s_selectivity</code> argument.</p></li>
<li><p>CAA - Fishery age composition matrix with nyears rows and OM@maxage+1 columns. If multiple fleets: an array with dimension: nyears, OM@maxage, and nfleets.</p></li>
<li><p>CAL - Fishery length composition matrix with nyears rows and columns indexing the length bin. If multiple fleets: an array with dimension: nyears,
length bins, and nfleets.</p></li>
<li><p>MS - A vector of fishery mean size (MS, either mean length or mean weight) observations (length OM@nyears), or if multiple fleets: matrix of dimension: nyears and nfleets.
Generally, mean lengths should not be used if <code>CAL</code> is also provided, unless mean length and length comps are independently sampled.</p></li>
<li><p>MS_type - A character (either <code>"length"</code> (default) or <code>"weight"</code>) to denote the type of mean size data.</p></li>
<li><p>MS_cv - The coefficient of variation of the observed mean size. If there are multiple fleets, a vector of length nfleet.
Default is 0.2.</p></li>
<li><p>s_CAA - Survey age composition data, an array of dimension nyears, maxage+1, nsurvey.</p></li>
<li><p>s_CAL - Survey length composition data, an array of dimension nyears, length(length_bin), nsurvey.</p></li>
<li><p>length_bin - A vector for the midpoints of the length bins for <code>CAL</code> and <code>s_CAL</code>. All bin widths should be equal in size.</p></li>
<li><p>C_eq - A numeric vector of length nfleet for the equilibrium catch for each fleet in <code>Chist</code> prior to the first year of the operating model.
Zero (default) implies unfished conditions in year one. Otherwise, this is used to estimate depletion in the first year of the data. Alternatively,
if one has a full CAA matrix, one could instead estimate "artificial" rec devs to generate the initial numbers-at-age (and hence initial depletion) in the first year of the model (see additional arguments).</p></li>
<li><p>C_eq_sd - A vector of standard deviations (lognormal distribution) for the equilibrium catches in <code>C_eq</code>.
If not provided, the default is 0.01. Only used if <code>condition = "catch"</code>.</p></li>
<li><p>E_eq - The equilibrium effort for each fleet in <code>Ehist</code> prior to the first year of the operating model.
Zero (default) implies unfished conditions in year one. Otherwise, this is used to estimate depletion in the first year of the data.</p></li>
<li><p>abs_I - Optional, an integer vector to indicate which indices are in absolute magnitude. Use 1 to set q = 1, otherwise use 0 to estimate q.</p></li>
<li><p>I_units - Optional, an integer vector to indicate whether indices are biomass based (1) or abundance-based (0). By default, all are biomass-based.</p></li>
<li><p>age_error - Optional, a square matrix of maxage + 1 rows and columns to specify ageing error. The aa-th column assigns a proportion of the true age in the
a-th row to observed age. Thus, all rows should sum to 1. Default is an identity matrix (no ageing error).</p></li>
<li><p>sel_block - Optional, for time-varying fleet selectivity (in time blocks), a integer matrix of nyears rows and nfleet columns to assigns a selectivity function to a fleet for certain years.</p></li>
</ul>

    <h2 class="hasAnchor" id="additional-arguments"><a class="anchor" href="#additional-arguments"></a>Additional arguments</h2>

    

<p>For <code>RCM</code>, additional arguments can be passed to the model via <code>...</code>:</p>
<ul>
<li><p>vul_par: A matrix of 3 rows and nfleet columns for starting values for fleet selectivity. The three rows correspond
to LFS (length of full selectivity), L5 (length of 5 percent selectivity), and Vmaxlen (selectivity at length Linf). By default,
the starting values are values from the OM object. If any selectivity = "free", then this matrix needs to be of maxage+1 rows where
the row specifies the selectivity at age. See Articles section.</p></li>
<li><p>ivul_par: A matrix of 3 rows and nsurvey columns for starting values for fleet selectivity. Same setup as vul_par. Values in the column are ignored
if <code>s_selectivity</code> is mapped to a fishing fleet (add NA placeholders in that case). 
If any <code>s_selectivity = "free"</code>, then this matrix needs to be of maxage+1 rows where
the row specifies the selectivity at age.</p></li>
<li><p>log_rec_dev: A numeric vector of length nyears for the starting values of the log-recruitment deviations.</p></li>
<li><p>log_early_rec_dev: A numeric vector of length OM@maxage for the starting values of the recruitment deviations controlling the abundance-at-age in the first year of the model.</p></li>
<li><p>map_vul_par: An integer matrix of the same dimension as vul_par. This is the 'map' argument for vul_par in TMB, see <a href='https://rdrr.io/pkg/TMB/man/MakeADFun.html'>MakeADFun</a>, which indicates whether selectivity parameters are fixed
or estimated. If an entry is <code>NA</code>, the corresponding parameter is fixed in the model to the starting
value. Otherwise, an integer for each independent parameter. By default, selectivity is fixed if there are no age or length composition for that fleet
or survey, otherwise estimated. Unused cells in the vul_par matrix should be given NA in the map matrix.</p></li>
<li><p>map_ivul_par: The map argument for the survey selectivity parameters (same dimension as ivul_par). Placeholder parameters should have a map value of NA.</p></li>
<li><p>map_log_early_rec_dev: A vector of length OM@maxage that indexes which recruitment deviates for the cohorts in the first year of the model are fixed (using NA) or estimated (a separate integer).
By default, no deviates are estimated (all are NA).</p></li>
<li><p>map_log_rec_dev: A vector of length OM@nyears that indexes which recruitment deviates are fixed (using NA) or estimated (a separate integer).
By default, all deviates are estimated.</p></li>
<li><p>plusgroup: Logical for whether the maximum age is a plusgroup or not. By default, TRUE.</p></li>
<li><p>fix_dome: Logical for whether the dome selectivity parameter for fleets is fixed. Used primarily for backwards compatibility, this is overridden by map_vul_par.</p></li>
<li><p>resample: Logical, whether the OM conditioning parameters (recruitment, fishing mortality, SSB, selectivity, etc.) are obtained by sampling the Hessian matrix from
a single model fit. By default FALSE. This feature requires identical biological parameters among simulations.</p></li>
</ul>

    <h2 class="hasAnchor" id="likelihood-weights"><a class="anchor" href="#likelihood-weights"></a>Likelihood weights</h2>

    

<p><code>LWT</code> is an optional named list containing the likelihood weights (values &gt;= 0) with the possible options:</p><ul>
<li><p>Chist, CAA, CAL, MS, C_eq: A vector of length nfleet for each.</p></li>
<li><p>Index, IAA, IAL: A vector of length nsurvey for each.</p></li>
</ul>

<p>By default, all likelihood weights are equal to one if not specified by the user.</p>
<p>Annual multinomial sample sizes for the age and length comps can now be provided directly in the 
<a href='RCMdata-class.html'>RCMdata</a> object. For a list or Data object, use the <code>ESS</code> argument.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='plot.RCModel.html'>plot.RCModel</a> <a href='RCModel-class.html'>RCModel</a> <a href='plot.RCModel.html'>compare_RCM</a> <a href='pcod.html'>pcod</a></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Q. Huynh</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{ </span>
<span class='co'># An example that conditions a Pacific cod operating model. There are 48 simulations, </span>
<span class='co'># where values of natural mortality and steepness are sampled from distributions. </span>
<span class='co'># The model is fitted with priors on the index catchability. Maturity and selectivity </span>
<span class='co'># are knife-edge at the age of 2 years. See online tutorial for more information.</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>pcod</span><span class='op'>)</span> 
<span class='va'>mat_ogive</span> <span class='op'>&lt;-</span> <span class='va'>pcod</span><span class='op'>$</span><span class='va'>OM</span><span class='op'>@</span><span class='va'>cpars</span><span class='op'>$</span><span class='va'>Mat_age</span><span class='op'>[</span><span class='fl'>1</span>, , <span class='fl'>1</span><span class='op'>]</span>
<span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'>RCM</span><span class='op'>(</span>OM <span class='op'>=</span> <span class='va'>pcod</span><span class='op'>$</span><span class='va'>OM</span>, data <span class='op'>=</span> <span class='va'>pcod</span><span class='op'>$</span><span class='va'>data</span>, 
           condition <span class='op'>=</span> <span class='st'>"catch"</span>, mean_fit <span class='op'>=</span> <span class='cn'>TRUE</span>,
           selectivity <span class='op'>=</span> <span class='st'>"free"</span>, s_selectivity <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"SSB"</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>pcod</span><span class='op'>$</span><span class='va'>data</span><span class='op'>@</span><span class='va'>Index</span><span class='op'>)</span><span class='op'>)</span>,
           vul_par <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>mat_ogive</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>mat_ogive</span><span class='op'>)</span>, <span class='fl'>1</span><span class='op'>)</span>,
           map_vul_par <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>mat_ogive</span><span class='op'>)</span>, <span class='fl'>1</span><span class='op'>)</span>,
           map_log_early_rec_dev <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>pcod</span><span class='op'>$</span><span class='va'>OM</span><span class='op'>@</span><span class='va'>maxage</span><span class='op'>)</span>,
           prior <span class='op'>=</span> <span class='va'>pcod</span><span class='op'>$</span><span class='va'>prior</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Checking OM and data...</span></div><div class='output co'>#&gt; <span class='message'>RCM model is conditioned on: catch</span></div><div class='output co'>#&gt; <span class='message'>1 fleet(s) detected.</span></div><div class='output co'>#&gt; <span class='message'>65 years of data detected.</span></div><div class='output co'>#&gt; <span class='message'>5 survey(s) detected.</span></div><div class='output co'>#&gt; <span class='message'>Getting biological parameters from OM...</span></div><div class='output co'>#&gt; <span class='message'>Mean weight data found.</span></div><div class='output co'>#&gt; <span class='message'>OM@maxF updated to 3.</span></div><div class='output co'>#&gt; <span class='message'>No fishery length or age compositions were provided. Selectivity is fixed to values from OM.</span></div><div class='output co'>#&gt; <span class='message'>Beverton-Holt stock-recruitment relationship used.</span></div><div class='output co'>#&gt; <span class='message'>Prior for q found.</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Fitting model (48 simulations) ...</span></div><div class='output co'>#&gt; <span class='message'>Generating additional model fit from mean values of parameters in the operating model...</span></div><div class='output co'>#&gt; <span class='message'>Range of unfished age-0 recruitment (OM@cpars$R0): 4811.99 - 14360.39</span></div><div class='output co'>#&gt; <span class='message'>Range of initial spawning depletion: 0.62 - 1.14</span></div><div class='output co'>#&gt; <span class='message'>Range of spawning depletion (OM@cpars$D): 0.21 - 0.37</span></div><div class='output co'>#&gt; <span class='message'>Historical F and selectivity trends set in OM@cpars$Find and OM@cpars$V, respectively.</span></div><div class='output co'>#&gt; <span class='message'>Selectivity during projection period is set to that in most recent historical year.</span></div><div class='output co'>#&gt; <span class='message'>Historical effort trends set in OM@EffLower and OM@EffUpper.</span></div><div class='output co'>#&gt; <span class='message'>Recruitment standard deviation set in OM@cpars$Perr.</span></div><div class='output co'>#&gt; <span class='message'>Historical recruitment set in OM@cpars$Perr_y.</span></div><div class='output co'>#&gt; <span class='message'>Range of recruitment autocorrelation OM@AC: 0.3 - 0.36</span></div><div class='output co'>#&gt; <span class='message'>Future recruitment deviations sampled with autocorrelation (in OM@cpars$Perr_y).</span></div><div class='output co'>#&gt; <span class='message'>Growth, maturity, natural mortality, and steepness values from RCM are set in OM@cpars.</span></div><div class='output co'>#&gt; <span class='message'>Historical catch data added to OM@cpars$Data@Cat.</span></div><div class='output co'>#&gt; <span class='message'>Historical indices added to OM@cpars$Data@AddInd.</span></div><div class='output co'>#&gt; <span class='message'>Complete.</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>out</span>, s_name <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>pcod</span><span class='op'>$</span><span class='va'>data</span><span class='op'>@</span><span class='va'>Index</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Registered S3 method overwritten by 'prodlim':</span>
#&gt; <span class='message'>  method    from   </span>
#&gt; <span class='message'>  plot.Hist MSEtool</span></div><div class='output co'>#&gt; <span class='message'>Generated markdown file: /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpRM5wlI/RCM.Rmd</span></div><div class='output co'>#&gt; <span class='message'>Rendering markdown file...</span></div><div class='output co'>#&gt; <span class='message'>Quitting from lines 676-680 (RCM.Rmd) </span></div><div class='output co'>#&gt; <span class='error'>Error in parse(text = x, srcfile = src): attempt to use zero-length variable name</span></div><div class='input'>
<span class='co'># Alternative OM with age-3 maturity and selectivity instead.</span>
<span class='va'>out_age3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/eval.html'>local</a></span><span class='op'>(</span><span class='op'>{</span>
  <span class='va'>pcod</span><span class='op'>$</span><span class='va'>OM</span><span class='op'>@</span><span class='va'>cpars</span><span class='op'>$</span><span class='va'>Mat_age</span><span class='op'>[</span>, <span class='fl'>2</span>, <span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>
  <span class='va'>mat_ogive_age3</span> <span class='op'>&lt;-</span> <span class='va'>pcod</span><span class='op'>$</span><span class='va'>OM</span><span class='op'>@</span><span class='va'>cpars</span><span class='op'>$</span><span class='va'>Mat_age</span><span class='op'>[</span><span class='fl'>1</span>, , <span class='fl'>1</span><span class='op'>]</span>
  <span class='fu'>RCM</span><span class='op'>(</span>OM <span class='op'>=</span> <span class='va'>pcod</span><span class='op'>$</span><span class='va'>OM</span>, data <span class='op'>=</span> <span class='va'>pcod</span><span class='op'>$</span><span class='va'>data</span>, 
      condition <span class='op'>=</span> <span class='st'>"catch"</span>, mean_fit <span class='op'>=</span> <span class='cn'>TRUE</span>,
      selectivity <span class='op'>=</span> <span class='st'>"free"</span>, s_selectivity <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"SSB"</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>pcod</span><span class='op'>$</span><span class='va'>data</span><span class='op'>@</span><span class='va'>Index</span><span class='op'>)</span><span class='op'>)</span>,
      vul_par <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>mat_ogive_age3</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>mat_ogive_age3</span><span class='op'>)</span>, <span class='fl'>1</span><span class='op'>)</span>,
      map_vul_par <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>mat_ogive_age3</span><span class='op'>)</span>, <span class='fl'>1</span><span class='op'>)</span>,
      map_log_early_rec_dev <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>pcod</span><span class='op'>$</span><span class='va'>OM</span><span class='op'>@</span><span class='va'>maxage</span><span class='op'>)</span>,
      prior <span class='op'>=</span> <span class='va'>pcod</span><span class='op'>$</span><span class='va'>prior</span><span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Checking OM and data...</span></div><div class='output co'>#&gt; <span class='message'>RCM model is conditioned on: catch</span></div><div class='output co'>#&gt; <span class='message'>1 fleet(s) detected.</span></div><div class='output co'>#&gt; <span class='message'>65 years of data detected.</span></div><div class='output co'>#&gt; <span class='message'>5 survey(s) detected.</span></div><div class='output co'>#&gt; <span class='message'>Getting biological parameters from OM...</span></div><div class='output co'>#&gt; <span class='message'>Mean weight data found.</span></div><div class='output co'>#&gt; <span class='message'>OM@maxF updated to 3.</span></div><div class='output co'>#&gt; <span class='message'>No fishery length or age compositions were provided. Selectivity is fixed to values from OM.</span></div><div class='output co'>#&gt; <span class='message'>Beverton-Holt stock-recruitment relationship used.</span></div><div class='output co'>#&gt; <span class='message'>Prior for q found.</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Fitting model (48 simulations) ...</span></div><div class='output co'>#&gt; <span class='message'>Generating additional model fit from mean values of parameters in the operating model...</span></div><div class='output co'>#&gt; <span class='message'>Range of unfished age-0 recruitment (OM@cpars$R0): 4811.99 - 14360.39</span></div><div class='output co'>#&gt; <span class='message'>Range of initial spawning depletion: 0.62 - 1.14</span></div><div class='output co'>#&gt; <span class='message'>Range of spawning depletion (OM@cpars$D): 0.21 - 0.37</span></div><div class='output co'>#&gt; <span class='message'>Historical F and selectivity trends set in OM@cpars$Find and OM@cpars$V, respectively.</span></div><div class='output co'>#&gt; <span class='message'>Selectivity during projection period is set to that in most recent historical year.</span></div><div class='output co'>#&gt; <span class='message'>Historical effort trends set in OM@EffLower and OM@EffUpper.</span></div><div class='output co'>#&gt; <span class='message'>Recruitment standard deviation set in OM@cpars$Perr.</span></div><div class='output co'>#&gt; <span class='message'>Historical recruitment set in OM@cpars$Perr_y.</span></div><div class='output co'>#&gt; <span class='message'>Range of recruitment autocorrelation OM@AC: 0.3 - 0.36</span></div><div class='output co'>#&gt; <span class='message'>Future recruitment deviations sampled with autocorrelation (in OM@cpars$Perr_y).</span></div><div class='output co'>#&gt; <span class='message'>Growth, maturity, natural mortality, and steepness values from RCM are set in OM@cpars.</span></div><div class='output co'>#&gt; <span class='message'>Historical catch data added to OM@cpars$Data@Cat.</span></div><div class='output co'>#&gt; <span class='message'>Historical indices added to OM@cpars$Data@AddInd.</span></div><div class='output co'>#&gt; <span class='message'>Complete.</span></div><div class='input'>  
<span class='fu'><a href='plot.RCModel.html'>compare_RCM</a></span><span class='op'>(</span><span class='va'>out</span>, <span class='va'>out_age3</span>, scenario <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Age-2 maturity"</span>, <span class='st'>"Age-3 maturity"</span><span class='op'>)</span><span class='op'>)</span>,
            s_name <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>pcod</span><span class='op'>$</span><span class='va'>data</span><span class='op'>@</span><span class='va'>Index</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Generated markdown file: /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpRM5wlI/compare_RCM.Rmd</span></div><div class='output co'>#&gt; <span class='message'>Rendering markdown file...</span></div><div class='output co'>#&gt; <span class='message'>Rendered file: /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/RtmpRM5wlI/compare_RCM.html</span></div><div class='input'><span class='co'># } </span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Quang Huynh, Tom Carruthers, Adrian Hordyk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


